<!DOCTYPE html>
<html lang="en-us">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  	<meta property="og:title" content=" energy prediction lpz &middot;  " />
  	<meta property="og:site_name" content="" />
  	<meta property="og:url" content="https://sysid.github.io/post/energy-prediction-lpz/" />

    
  	<meta property="og:type" content="article" />

    <meta property="og:article:published_time" content="2017-05-28T12:27:54&#43;02:00" />

    
    <meta property="og:article:tag" content="sysid" />
    
    <meta property="og:article:tag" content="machine learning" />
    
    <meta property="og:article:tag" content="forecast" />
    
    

  <title>
     energy prediction lpz &middot;  
  </title>

    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://sysid.github.io/images/favicon.ico">
	  <link rel="apple-touch-icon" href="https://sysid.github.io/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="https://sysid.github.io/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://sysid.github.io/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
      
          <link href="https://sysid.github.io/index.xml" rel="alternate" type="application/rss+xml" title="" />
      
      
    
    <meta name="generator" content="Hugo 0.18.1" />

    <link rel="canonical" href="https://sysid.github.io/post/energy-prediction-lpz/" />

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-49519316-2', 'auto');
      ga('send', 'pageview');

    </script>
    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://sysid.github.io/">My Blog</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://sysid.github.io/about">About me</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://sysid.github.io/machine-learning/">ML Cheat Sheet</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://sysid.github.io/lighthouse-examples/">lighthouse examples</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://sysid.github.io/linklist/">linklist</a>
            </li>
        
    </ul>
    
    
    <a class="subscribe-button icon-feed" href="https://sysid.github.io/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">




<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">energy prediction lpz</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2017-05-28T12:27:54&#43;02:00">
            May 28, 2017
          </time>
        
         
          <span class="post-tag small"><a href="https://sysid.github.io/tags/sysid/">#sysid</a></span>
         
          <span class="post-tag small"><a href="https://sysid.github.io/tags/machine-learning/">#machine learning</a></span>
         
          <span class="post-tag small"><a href="https://sysid.github.io/tags/forecast/">#forecast</a></span>
         
        </section>
    </header>

    <section class="post-content">
      


<figure >
    
        <img src="https://sysid.github.io/images/prognose/plant_lpz.png" />
    
    
</figure>


<h1 id="energy-forecast-for-a-full-scale-vehicle-plant">Energy Forecast for a full scale Vehicle Plant</h1>

<p>Energy forecasting is based on time series analysis.
There are many techniques for analysing and forecasting time series, e.g. ARIMA, linear regression and deep learning.
To tackle the challenge at hand a linear regression will be the benchmark model aganst which deep learning models will be tested. In particular a multi layer perceptron (MLP) and recurrent
neural network (RNN), i.e.  Long-Short Time Memory (LSTM) model will be applied.</p>

<h2 id="business-domain">Business Domain</h2>

<p>Energy forecasting is a tricky challenge because many factors might influence the final energy demand of a complex system
like a large manufacturing plant. Especially when the plant employs
not only energy consumers but also energy producers like CHPs and wind farms or energy reservoirs like battery farms.
Significant factors to take into account:</p>

<ul>
<li>production plan</li>
<li>CHP energy production</li>
<li>weather, i.e. temperature, wind</li>
</ul>

<h2 id="data-preparation">Data Preparation</h2>

<p>In order to apply the described techniques the problem has to be framed as a supervised learning problem. The data at hand is an hourly measurment of energy consumption
in 2015 as well as associated production plans and weather data. This results to a multivariate time series. The variable to forecast is energy consumption for the next 48 hours.</p>

<p>For application in a LSTM neural network with <strong><code>tanh</code></strong> non-linearity the data need to be scaled to the interval [-1,1]. Furthermore we split it into a training set (80%) and a test set (20%).</p>

<p>For forecasting different tactics can be applied.</p>

<ol>
<li><strong>Linear</strong> regression: the timesteps are taken as independent from the past an only dependent on the feature vector at time t=0.</li>
<li><strong>MLP</strong>: similar to linear regression with respect to feature preparation.</li>
<li><strong>LSTM</strong>: the timesteps are dependent on their predecessors and therefor the see-behind window is a hyperparameter to be chosen for the model.</li>
</ol>

<p>For this analysis the LSTM model will have two variants with regards to the lookback window:</p>

<ol>
<li>the entire dataset will be taken as sequence length, i.e. the LSTM context will be build over the entire time series. In Keras this results in a statfull LSTM network with batch-size 1 (online learning)..</li>
<li>a lookback window of 14days will be taken. This allows for batch-size &gt; 0 and a stateless LSTM network.</li>
</ol>

<p>For the non RNN models also information from previous timesteps can be encoded into the feature vector by just putting the values of past timesteps as additional features into the feature vector.
Here we also use the information of the last 14 days to be consistent within our model choices.</p>

<p>For all models the following parameters/features have been selected:</p>

<ol>
<li>energy consumption</li>
<li>air temperature</li>
<li>wind speed</li>
<li>wind direction</li>
<li>production plan</li>
</ol>

<p>This results in a feature vector for the linear models of dimension 1872:</p>

<ul>
<li>lookback: 14days*24h*5features</li>
<li>lookforward: 2days*24h*4features (5th parameter is the energy and is the label in our models to be forecasted)</li>
</ul>

<h4 id="timestamp-challenges">Timestamp Challenges</h4>

<p>Keeping the timestamps correct after all the data transformations is a special challenge which requires careful handling. The following diagram illustrates the topic. Left you can see the resulting dataset for a lookback window of 14days whereas on the right for a lookback window of 1hour. In order to compare results, the inverse date transformations have to take this into account.</p>


<figure >
    
        <img src="https://sysid.github.io/images/prognose/temporal_adjustment.png" />
    
    
</figure>


<h2 id="model">Model</h2>

<p>We predict the entire 48 hours with one prediction in order to avoid instabilities introduced by step-by-step forecasting and then using the forecast as feature for the next forecast.</p>

<p>For the linear regression the venerable <a href="http://scikit-learn.org/stable/">scikit-learn</a> library is used.
For all the deep-learning <a href="https://keras.io/">KERAS</a> and <a href="https://www.tensorflow.org/">TENSORFLOW</a> are the tools of choice.</p>


<figure >
    
        <img src="https://sysid.github.io/images/prognose/models.png" />
    
    
</figure>


<p>The MLP model has got 1.4 Mio parameters, so its capacity is much higher then the LSTM.
This gives already a first hint towards further optimization of model setup.</p>

<h2 id="result">Result</h2>

<p>Quality of forecast is measured as MSE (mean squared error). All plots show an arbitrary point in time of the test set with 14days
in the past and 2 days forecast. Every model is compared to the naive linear regression (red line).</p>

<h3 id="ltsm">LTSM</h3>


<figure >
    
        <img src="https://sysid.github.io/images/prognose/rnn.png" />
    
    
</figure>


<p>The LTSM model overall shows an MSE of 0.025 on the test set.</p>

<p>The red box shows an outlier in the linear regression.
It seems like the linear model did not pick up a significant feature like production plan properly.
The LSTM did a better job here.</p>

<h3 id="mlp">MLP</h3>


<figure >
    
        <img src="https://sysid.github.io/images/prognose/mlp.png" />
    
    
</figure>


<p>The MLP model overall shows an MSE of 0.063 on the test set.</p>

<h3 id="conclusion">Conclusion</h3>

<p>Although both deep learning approaches can predict the shape of the time series well, the LSTM model exhibits higher accuracy.
Since the model capacity is much lower, this was a surprising outcome.</p>

<p>However both deep learning approaches seem struggle to match the quality of a simple linear regression forecast.
Due to time contraints no hyperparameter or model tuning has taken place. There are many areas for potential improvements, e.g.
- detailed feature preparation, especially production plans
- exploration of more neural network configurations (number of layers, number of timesteps, number of neurons, &hellip;)
- hyperparameter tuning (regularization, learning rates, optimiziers, &hellip;)</p>

<p>Thanks for reading.</p>

    </section>


  <footer class="post-footer">


    

    





<section class="author">
  <h4><a href="https://sysid.github.io/">TW</a></h4>
  
  <p>Read <a href="https://sysid.github.io/">more posts</a> by this author.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Germany</span>
    
  </div>
</section>



    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=energy%20prediction%20lpz&amp;url=https%3a%2f%2fsysid.github.io%2fpost%2fenergy-prediction-lpz%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fsysid.github.io%2fpost%2fenergy-prediction-lpz%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fsysid.github.io%2fpost%2fenergy-prediction-lpz%2f&amp;description=energy%20prediction%20lpz"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=https%3a%2f%2fsysid.github.io%2fpost%2fenergy-prediction-lpz%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    

<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'sysid';
  var disqus_url = 'https:\/\/sysid.github.io\/post\/energy-prediction-lpz\/';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




  </footer>
</article>

</main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href=""></a> All rights reserved - 2016</section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="https://sysid.github.io/js/jquery.js"></script>
    <script type="text/javascript" src="https://sysid.github.io/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://sysid.github.io/js/index.js"></script>
    
</body>
</html>

