<!doctype html><html lang="en"><head><meta charset="utf-8"><link rel="shortcut icon" href="/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="canonical" href="/posts/2019-11-02/munggoggo" />

      <title data-rh="true">Munggoggo: A modern message based async agent framework</title>
      
      
    <link rel="stylesheet" href="/static/css/8.824c8069.chunk.css" /><script>window.__NAVI_STATE__={"__navi__":{"requestDataWithoutState":{}}};</script><link href="/static/css/main.512956a1.chunk.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="BlogLayout_container__1fiRb"><div class="
        LoadingIndicator_LoadingIndicator__3KSl0
        
        undefined
      "></div><header><h3 class="BlogLayout_title__3HyDU"><a href="/" class=" ">sysid blog</a></h3></header><main><article><header class="BlogPostLayout_header__1Ny4T"><h1 class="BlogPostLayout_title__2L_2_"><a href="/posts/2019-11-02/munggoggo" class=" ">Munggoggo: A modern message based async agent framework</a></h1><small><time dateTime="Fri, 01 Nov 2019 23:00:00 GMT">November 2, 2019</time> <!-- -->•<!-- --> <ul class="ArticleMeta_tags__1IJ9w"><li><a href="/tags/python" class=" ">python</a></li><li><a href="/tags/async" class=" ">async</a></li><li><a href="/tags/agent" class=" ">agent</a></li><li><a href="/tags/RabbitMQ" class=" ">RabbitMQ</a></li></ul> <!-- -->•<!-- --> <span>☕️<!-- --> <!-- -->2<!-- --> min read</span></small></header><div class="BlogPostLayout_content__1mzTO"><div class="document_Document__NswW2"><p>An asyncio based agent platform written in Python and based on RabbitMQ. </p><p>Agents are isolated processes which can host multiple parallel running behaviours implementing business
logic and can be deployed as independent kubernetes pods. Access to the agent mesh is via
REST/HTTP, websocket and jsonrpc.</p><p>A few lines of code implement a fully fledged agent with a simple behaviour: sending and
receiving ping messages to/from other agents.</p><pre><code class="language-python" data-language="python" data-highlighted-line-numbers=""><span class="token keyword">from</span> mode <span class="token keyword">import</span> Worker
<span class="token keyword">from</span> behaviour <span class="token keyword">import</span> Behaviour
<span class="token keyword">from</span> core <span class="token keyword">import</span> Core


<span class="token keyword">class</span> <span class="token class-name">Agent</span><span class="token punctuation">(</span>Core<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">PingBehav</span><span class="token punctuation">(</span>Behaviour<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">setup</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>counter <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>counter <span class="token operator">+=</span> <span class="token number">1</span>
            msg <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>receive<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> msg<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">: Message received: </span><span class="token interpolation"><span class="token punctuation">{</span>msg<span class="token punctuation">.</span>body<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">await</span> self<span class="token punctuation">.</span>publish<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>counter<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'ping'</span><span class="token punctuation">)</span>
            <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.9</span><span class="token punctuation">)</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">setup</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">""" Register behaviour and subscribe to 'ping' topic """</span>
        <span class="token keyword">await</span> self<span class="token punctuation">.</span>add_runtime_dependency<span class="token punctuation">(</span>self<span class="token punctuation">.</span>PingBehav<span class="token punctuation">(</span>self<span class="token punctuation">,</span> binding_keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'ping'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    Worker<span class="token punctuation">(</span>Agent<span class="token punctuation">(</span>identity<span class="token operator">=</span><span class="token string">'AgentIdentity'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> loglevel<span class="token operator">=</span><span class="token string">"info"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execute_from_commandline<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p>Documentation: <a href="https://munggoggo.readthedocs.io/en/latest/" class=" ">https://munggoggo.readthedocs.io/en/latest/</a><br/>
<!-- -->Github: <a href="https://github.com/sysid/munggoggo" class=" ">https://github.com/sysid/munggoggo</a></p><h2 id="why">Why</h2><p>The physical world forms a massive parallel system.  </p><p>The metaphor of software agents communicating via messages helps to model this realty.
Devices like cars, buildings, etc. can be interpreted as independently acting
agents communicating via message protocols like AMQP. </p><p>Today’s software technology has evolved far enough to model this reality without access to supercomputers or
highly specialized programming paradigms. Agents running async business logic are a suitable fit and
can be implemented with various prevalent technology stacks.</p><h2 id="technology-stack-choice">Technology Stack Choice</h2><p>Requirements for our tech stack, driven by business reality:</p><ol><li>very fast turnover and implementation cycles (experiment, learn, extract useful part, repeat…)</li><li>focus on data driven models and algorithms, based on IoT data streams (e.g. vehicles)</li><li>loose coupling and independent entity modelling </li><li>cloud first (of course…)</li><li>standards based and seamless systems integration</li><li>scalability</li></ol><p>For us this translated in:</p><ol><li>Python as programming language wich allows quick development cycles and has got a well established footprint
in data science and data computing</li><li>Messaging backend based on AMQP (RabbitMQ) which supports streaming processing while simultaneously allowing
sophisticated routing and communication patterns</li><li>Async programming paradigm in order to fully capitalize on stream processing</li><li>Agent metaphor for independent computing units exposing one ore more behaviours</li></ol><h2 id="bringing-it-together">Bringing it together</h2><p>Combining these ideas, reviewing existing solutions and including a few original ideas
eventually led to this prototype implementation of a behavioural agent software framework based on async python, RabbitMQ and
ASGI as web programming model.  </p><p>It is a personal PoC rather than production ready software and its potential is to be verified.</p><p>In any case it demonstrates some interesting ideas to address the described problem domain and combines some of the latest
python programming paradigms.</p></div></div><footer class="BlogPostLayout_footer__3ofxa"><h3 class="BlogPostLayout_title__2L_2_"><a href="/" class=" ">sysid blog</a></h3><div class="
      Bio_Bio__1ks_2
      BlogPostLayout_bio__diNn9
    "><img src="https://www.gravatar.com/avatar/feaf8eda41fb14fc93549065913f3fee.jpg?s=56&amp;d=identicon" alt="Me"/><p>Always be building, by<!-- --> <a href="mail://sysid@gmx.de">sysid</a>.</p></div><section class="BlogPostLayout_links__-LX2X"><a class="BlogPostLayout_next__KrMHx " href="/posts/2017-05-28/energy-prediction-lpz">Energy Forecast for a full scale Vehicle Plant<!-- --> →</a></section></footer></article></main></div></div><script>!function(i){function e(e){for(var t,r,n=e[0],o=e[1],a=e[2],u=0,c=[];u<n.length;u++)r=n[u],d[r]&&c.push(d[r][0]),d[r]=0;for(t in o)Object.prototype.hasOwnProperty.call(o,t)&&(i[t]=o[t]);for(h&&h(e);c.length;)c.shift()();return l.push.apply(l,a||[]),f()}function f(){for(var e,t=0;t<l.length;t++){for(var r=l[t],n=!0,o=1;o<r.length;o++){var a=r[o];0!==d[a]&&(n=!1)}n&&(l.splice(t--,1),e=p(p.s=r[0]))}return e}var r={},s={1:0},d={1:0},l=[];function p(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,p),t.l=!0,t.exports}p.e=function(l){var e=[];s[l]?e.push(s[l]):0!==s[l]&&{3:1,4:1,5:1,6:1,7:1,8:1}[l]&&e.push(s[l]=new Promise(function(e,n){for(var t="static/css/"+({}[l]||l)+"."+{3:"7ac248b7",4:"a513364e",5:"17727e1f",6:"303b9364",7:"15f7c63d",8:"824c8069",9:"31d6cfe0",10:"31d6cfe0",11:"31d6cfe0",12:"31d6cfe0",13:"31d6cfe0"}[l]+".chunk.css",o=p.p+t,r=document.getElementsByTagName("link"),a=0;a<r.length;a++){var u=(i=r[a]).getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(u===t||u===o))return e()}var c=document.getElementsByTagName("style");for(a=0;a<c.length;a++){var i;if((u=(i=c[a]).getAttribute("data-href"))===t||u===o)return e()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=e,f.onerror=function(e){var t=e&&e.target&&e.target.src||o,r=new Error("Loading CSS chunk "+l+" failed.\n("+t+")");r.request=t,delete s[l],f.parentNode.removeChild(f),n(r)},f.href=o,document.getElementsByTagName("head")[0].appendChild(f)}).then(function(){s[l]=0}));var r=d[l];if(0!==r)if(r)e.push(r[2]);else{var t=new Promise(function(e,t){r=d[l]=[e,t]});e.push(r[2]=t);var n,a=document.createElement("script");a.charset="utf-8",a.timeout=120,p.nc&&a.setAttribute("nonce",p.nc),a.src=p.p+"static/js/"+({}[l]||l)+"."+{3:"3d60693d",4:"29e65eb7",5:"ec8d28ab",6:"90a8ff57",7:"9969cb1e",8:"8373ce81",9:"eb28f18b",10:"f6566525",11:"1b83a9c9",12:"3c00d861",13:"a432f905"}[l]+".chunk.js",n=function(e){a.onerror=a.onload=null,clearTimeout(u);var t=d[l];if(0!==t){if(t){var r=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src,o=new Error("Loading chunk "+l+" failed.\n("+r+": "+n+")");o.type=r,o.request=n,t[1](o)}d[l]=void 0}};var u=setTimeout(function(){n({type:"timeout",target:a})},12e4);a.onerror=a.onload=n,document.head.appendChild(a)}return Promise.all(e)},p.m=i,p.c=r,p.d=function(e,t,r){p.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},p.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},p.t=function(t,e){if(1&e&&(t=p(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(p.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)p.d(r,n,function(e){return t[e]}.bind(null,n));return r},p.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return p.d(t,"a",t),t},p.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},p.p="/",p.oe=function(e){throw console.error(e),e};var t=window.webpackJsonp=window.webpackJsonp||[],n=t.push.bind(t);t.push=e,t=t.slice();for(var o=0;o<t.length;o++)e(t[o]);var h=n;f()}([])</script><script src="/static/js/2.304d91e0.chunk.js"></script><script src="/static/js/main.978caf9a.chunk.js"></script></body></html>