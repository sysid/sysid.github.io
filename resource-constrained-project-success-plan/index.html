<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="/images/favicon.png" />
<title>Resource Constrained Project Success Plan | sysid blog</title>
<meta name="title" content="Resource Constrained Project Success Plan" />
<meta name="description" content="Too many things to do, too little time ..." />
<meta name="keywords" content="python,optimization,pyomo," />


<meta property="og:title" content="Resource Constrained Project Success Plan" />
<meta property="og:description" content="Too many things to do, too little time ..." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/resource-constrained-project-success-plan/" /><meta property="og:image" content="images/share.png"/><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2020-07-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-07-18T00:00:00+00:00" /><meta property="og:site_name" content="sysid blog" />



<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="images/share.png"/>

<meta name="twitter:title" content="Resource Constrained Project Success Plan"/>
<meta name="twitter:description" content="Too many things to do, too little time ..."/>



<meta itemprop="name" content="Resource Constrained Project Success Plan">
<meta itemprop="description" content="Too many things to do, too little time ..."><meta itemprop="datePublished" content="2020-07-18T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-07-18T00:00:00+00:00" />
<meta itemprop="wordCount" content="764"><meta itemprop="image" content="images/share.png"/>
<meta itemprop="keywords" content="python,optimization,pyomo," />
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  body {
    font-family: Verdana, sans-serif;
    margin: auto;
    padding: 20px;
    max-width: 720px;
    text-align: left;
    background-color: #fff;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: #444;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  strong,
  b {
    color: #222;
  }

  a {
    color: #3273dc;
     
  }

  .title {
    text-decoration: none;
    border: 0;
  }

  .title span {
    font-weight: 400;
  }

  nav a {
    margin-right: 10px;
  }

  textarea {
    width: 100%;
    font-size: 16px;
  }

  input {
    font-size: 16px;
  }

  content {
    line-height: 1.6;
  }

  table {
    width: 100%;
  }

  img {
    max-width: 100%;
  }

  code {
    padding: 2px 5px;
    background-color: #f2f2f2;
  }

  pre code {
    color: #222;
    display: block;
    padding: 20px;
    white-space: pre-wrap;
    font-size: 14px;
    overflow-x: auto;
  }

  div.highlight pre {
    background-color: initial;
    color: initial;
  }

  div.highlight code {
    background-color: unset;
    color: unset;
  }

  blockquote {
    border-left: 1px solid #999;
    color: #222;
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px;
    text-align: center;
  }

  .helptext {
    color: #777;
    font-size: small;
  }

  .errorlist {
    color: #eba613;
    font-size: small;
  }

   
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
    color: #8b6fcb;
  }

  @media (prefers-color-scheme: dark) {
    body {
      background-color: #333;
      color: #ddd;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    strong,
    b {
      color: #eee;
    }

    a {
      color: #8cc2dd;
    }

    code {
      background-color: #777;
    }

    pre code {
      color: #ddd;
    }

    blockquote {
      color: #ccc;
    }

    textarea,
    input {
      background-color: #252525;
      color: #ddd;
    }

    .helptext {
      color: #aaa;
    }
  }

</style>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-8VH574W51S"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-8VH574W51S', { 'anonymize_ip': false });
}
</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@4.0.0-alpha.1/es5/tex-mml-chtml.js"></script>


<script>
    MathJaxDone = new Promise((resolve, reject) => {
        window.MathJax = {
            tex: {inlineMath: [['$', '$'], ['\\(', '\\)']]},
            startup: {
                pageReady() {
                    return MathJax.startup.defaultPageReady().then(resolve);
                }
            }
        }
    });
</script>

</head>

<body>
  <header><a href="/" class="title">
  <h2>sysid blog</h2>
</a>
<nav><a href="/">Home</a>

<a href="/tools">Tools</a>


<a href="/blog">Blog</a>

</nav>
</header>
  <main>

<h1>Resource Constrained Project Success Plan</h1>
<p>
  <i>
    <time datetime='2020-07-18' pubdate>
      18 Jul, 2020
    </time>
  </i>
</p>

<content>
  <p>Scheduling tasks in a large project translates to facing a graph optimization challenge:</p>
<figure class="center"><img src="network.png" width="100%"/>
</figure>

<blockquote>
<p>The Resource-Constrained Project Scheduling Problem is a combinatorial optimization problem that consists of finding
a feasible scheduling for a set of \(n\) jobs subject to resource and precedence constraints.</p>
</blockquote>
<h2 id="problem-domain-network-optimization">Problem Domain: Network Optimization.</h2>
<p>Taks are represented by nodes. Dependencies of tasks on predecessors form a directed graph. Every task has got a
duration which is represented by the weight of the directed edges of the graph. Tasks consume limited resources.
In order to provide an entry and exit point to the graph we introduce two <em>dummy</em> tasks,
\(x_0, x_{n+1}\) with duration 0 and no resource consumption (a.k.a. sentinels).</p>
<h1 id="model">Model</h1>
<p>$$
\begin{aligned}
J: &amp;\text{ jobs set }\\
R: &amp;\text{ renewable resources set }\\
S: &amp;\text{ set of precedences (edges) between jobs \((ùëñ, ùëó) \in J \times J\) }\\
T: &amp;\text{ planning horizon: set of possible processing times for jobs }\\
p_j &amp;\text{ processing time of job ùëó }\\
u_{r,j} &amp;\text{ amount of resource ùëü required for processing job ùëó}\\
c_r &amp;\text{ capacity of renewable resource \(r\) }\\
\end{aligned}
$$</p>
<p>Example with two resources \(r1, r2\) and resource usage \(u_{j,r}\):</p>
<figure class="center"><img src="resources.png"/>
</figure>

<h3 id="variable">Variable</h3>
<p>$$
x_{jt} =
\begin{cases}
1, \ \text{ if job ùëó is completed in period t }\\
0, \ \text{ else }\\
\end{cases}
$$</p>
<h3 id="objective">Objective</h3>
<p>Minimize the total duration of task completion subject to dependency and resource constraints:
$$
\min \sum_t (t-1) x_{n+1, t}\\
s.t.\\
$$</p>
<h3 id="constraints">Constraints</h3>
<p>Every job incl. end sentinel must be finished latest by end of last time interval:
$$
\sum_t x_{j,t} = 1, \ \forall j \in J \cup {n+1}\\
$$</p>
<h4 id="resource-consumption-constraint">Resource Consumption Constraint:</h4>
<p>A job is being processed in period \(t\) if the job is completed in period \(q\) where:
$$
t \le q \le t + p_j
$$</p>
<p>$$
\sum_j \sum_{q=t}^{\min{{T+1, t+p_j}}} u_{j,r} x_{j,q} \le c_r, \ \forall t, r \\
$$</p>
<p>For another technique to formulate this kind of constraint see <a href="../patient-scheduling/">Patient Scheduling problem</a>.
There we simplify this constraint type with the help of a binary helper data structure.</p>
<h4 id="sequence-constraint">Sequence constraint:</h4>
<p>Job \(m\) must precede job \(n\). If \(t_m, t_n\) denote the completion time, then:</p>
<p>$$
t_m + p_n \le t_n \\
t_j = \sum_t t x_{j,t}\\
$$</p>
<p>$$
\sum_t t x_{j,t} + p_s \le \sum_t t x_{s,t} , \ \forall (j,s) \in S \\
$$</p>
<h4 id="binary-constraint">Binary Constraint:</h4>
<p>$$
x_{j,t} \in {0,1}\\
$$</p>
<h1 id="implementation">Implementation</h1>
<p>This time the solution of the problem provides two interesting challenges:</p>
<h2 id="1-solving-the-mip-problem">1. Solving the MIP problem</h2>
<p>The implementation with <a href="http://www.pyomo.org/">Pyomo</a> is close to the mathematical problem formulation and therefore straight forward.
However, testing and debugging the resource consumption constraint proved to be more involved than expected.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#888"># resource consumption contraint:</span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">resource_c</span>(model, t, r):
</span></span><span style="display:flex;"><span>    <span style="color:#080;font-weight:bold">if</span> t == <span style="color:#038">len</span>(model.T):
</span></span><span style="display:flex;"><span>        <span style="color:#080;font-weight:bold">return</span> Constraint.Skip
</span></span><span style="display:flex;"><span>    <span style="color:#080;font-weight:bold">return</span> <span style="color:#038">sum</span>(
</span></span><span style="display:flex;"><span>        model.u[j, r] * model.x[j, q]
</span></span><span style="display:flex;"><span>        <span style="color:#080;font-weight:bold">for</span> j <span style="color:#080">in</span> <span style="color:#038">list</span>(model.J)[<span style="color:#00d;font-weight:bold">1</span>:-<span style="color:#00d;font-weight:bold">1</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#080;font-weight:bold">for</span> q <span style="color:#080">in</span> <span style="color:#038">range</span>(
</span></span><span style="display:flex;"><span>            t, <span style="color:#038">min</span>(<span style="color:#038">len</span>(model.T) + <span style="color:#00d;font-weight:bold">1</span>, t + value(model.p[j]) - <span style="color:#00d;font-weight:bold">0</span>)
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    ) &lt;= model.c[r]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model.resource_c = Constraint(model.T, model.R, rule=resource_c)
</span></span></code></pre></div><p>Testing the decisions of a MIP solver involves indirect reasoning. There is no debugger which can be attached to the
solver in order to set breakpoints (unless you are the solver&rsquo;s developer, of course).</p>
<p>As a software developer it is probably good advice to follow a path as in
<a href="../patient-scheduling">Patient Scheduling</a>, where complexity is taken out of the mathematical model and put
into helper data structures which can be tested and debugged with tools of the trade.</p>
<h2 id="2-visualizing-the-result">2. Visualizing the result</h2>
<p>Since we have a multi-dimensional result, visualization requires some thought. After all we want to see the temporal sequence of
tasks together with a representation of respective resource consumption. Tasks will run in parallel when resource consumption allows for it.</p>
<p>Luckily with <a href="https://matplotlib.org/">mathplotlib</a> we have a Python library which provides all the necessary routines and tools in order to visualize
even the most complex data-sets.</p>
<p>I chose to visualize &lsquo;swim lanes&rsquo; per resource, where the height of the swim lane represents the resource limit, and the
length represents the maximum length if all jobs would have been run sequentially (naive solution).</p>
<h1 id="result">Result</h1>
<p>Our example problem is a relatively small MIP problem and CBC has no problems solving it within a second:</p>
<p>Number of constraints : 97<br>
Number of variables : 420</p>
<figure class="center"><img src="rcpsp_result.png" width="100%"/>
</figure>

<p>The optimal solution is more than one third &lsquo;better&rsquo; than the naive solution by parallelizing tasks where
possible. Hereby the sequence of tasks is respected as well as the limitation of resources. Get more done in the same amount of time.</p>
<p>If you are interested in other MIP problems regarding task scheduling, please check out <a href="../task-scheduling">Task Scheduling</a>,
<a href="../the-book-of-mormon">The Book of Mormon</a> and <a href="../the-book-of-mormon-ii">The Book of Mormon II</a>.</p>

</content>
<p>
  
  <a href="/blog/python/">#python</a>
  
  <a href="/blog/optimization/">#optimization</a>
  
  <a href="/blog/pyomo/">#pyomo</a>
  
</p>

  </main>
  <footer>
</footer>

    
</body>

</html>
