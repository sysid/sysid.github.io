<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="/images/favicon.png" />
<title>Software Architecture 2022 | sysid blog</title>
<meta name="title" content="Software Architecture 2022" />
<meta name="description" content="From CRUD over DDD to CQRS to Event Sourcing and further..." />
<meta name="keywords" content="python,work," />


<meta property="og:title" content="Software Architecture 2022" />
<meta property="og:description" content="From CRUD over DDD to CQRS to Event Sourcing and further..." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/software-architecture-2022/" /><meta property="og:image" content="images/share.png"/><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2021-12-31T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-12-31T00:00:00+00:00" /><meta property="og:site_name" content="sysid blog" />



<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="images/share.png"/>

<meta name="twitter:title" content="Software Architecture 2022"/>
<meta name="twitter:description" content="From CRUD over DDD to CQRS to Event Sourcing and further..."/>



<meta itemprop="name" content="Software Architecture 2022">
<meta itemprop="description" content="From CRUD over DDD to CQRS to Event Sourcing and further..."><meta itemprop="datePublished" content="2021-12-31T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-12-31T00:00:00+00:00" />
<meta itemprop="wordCount" content="664"><meta itemprop="image" content="images/share.png"/>
<meta itemprop="keywords" content="python,work," />
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  body {
    font-family: Verdana, sans-serif;
    margin: auto;
    padding: 20px;
    max-width: 720px;
    text-align: left;
    background-color: #fff;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: #444;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  strong,
  b {
    color: #222;
  }

  a {
    color: #3273dc;
     
  }

  .title {
    text-decoration: none;
    border: 0;
  }

  .title span {
    font-weight: 400;
  }

  nav a {
    margin-right: 10px;
  }

  textarea {
    width: 100%;
    font-size: 16px;
  }

  input {
    font-size: 16px;
  }

  content {
    line-height: 1.6;
  }

  table {
    width: 100%;
  }

  img {
    max-width: 100%;
  }

  code {
    padding: 2px 5px;
    background-color: #f2f2f2;
  }

  pre code {
    color: #222;
    display: block;
    padding: 20px;
    white-space: pre-wrap;
    font-size: 14px;
    overflow-x: auto;
  }

  div.highlight pre {
    background-color: initial;
    color: initial;
  }

  div.highlight code {
    background-color: unset;
    color: unset;
  }

  blockquote {
    border-left: 1px solid #999;
    color: #222;
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px;
    text-align: center;
  }

  .helptext {
    color: #777;
    font-size: small;
  }

  .errorlist {
    color: #eba613;
    font-size: small;
  }

   
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
    color: #8b6fcb;
  }

  @media (prefers-color-scheme: dark) {
    body {
      background-color: #333;
      color: #ddd;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    strong,
    b {
      color: #eee;
    }

    a {
      color: #8cc2dd;
    }

    code {
      background-color: #777;
    }

    pre code {
      color: #ddd;
    }

    blockquote {
      color: #ccc;
    }

    textarea,
    input {
      background-color: #252525;
      color: #ddd;
    }

    .helptext {
      color: #aaa;
    }
  }

</style>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-8VH574W51S"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-8VH574W51S', { 'anonymize_ip': false });
}
</script>


</head>

<body>
  <header><a href="/" class="title">
  <h2>sysid blog</h2>
</a>
<nav><a href="/">Home</a>


<a href="/blog">Blog</a>

</nav>
</header>
  <main>

<h1>Software Architecture 2022</h1>
<p>
  <i>
    <time datetime='2021-12-31' pubdate>
      31 Dec, 2021
    </time>
  </i>
</p>

<content>
  <blockquote>
<p>A refresher in software architecture philosophies with Perseverance, Patience and Python.</p>
</blockquote>
<p>This is a high-speed overflight over current approaches with an occasional deep dive.</p>
<h2 id="crud-mvc">CRUD, MVC</h2>
<ul>
<li>simple concepts and therefore effective communication in dev teams</li>
<li>works as expected. Limits known, e.g. modelling complex business domains</li>
</ul>
<h2 id="ddd-and-clean-architecture">DDD and Clean Architecture</h2>
<figure class="center"><img src="layered.png" width="100%"/>
</figure>

<ul>
<li>structure of software logic reflects business processes</li>
<li><strong>ubiquitous language</strong> as common communication ground for developer and business</li>
<li>concepts like <strong>Aggregate</strong> and <strong>UnitOfWork</strong> provide clear consistency and concurrency model. Facilitates communication.</li>
<li>Clean Architecture and DI is conducive to structured and decoupled code (SRP)
<a href="https://netflixtechblog.com/ready-for-changes-with-hexagonal-architecture-b315ec967749"><figure class="center"><img src="hexagon.png" width="100%"/>
</figure>
</a>
<a href="https://medium.com/gdplabs/clean-architecture-a8b5d93d0944"><figure class="center"><img src="clean_architecture.png" width="100%"/>
</figure>
</a></li>
</ul>
<p><a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html"><figure class="center"><img src="dep_vs_flow.png" width="100%"/>
</figure>
</a>
Every system has these two kind of arrows:
the dotted-green one showing the flow of control (or the flow of data in your system) and the red one showing the source code dependency.</p>
<p>Usually, both of them are pointing in the same direction.
However, with the dependency inversion principle, we can invert the red arrow (the dependency arrow) every time we want.
Everywhere we need it.
<a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html"><figure class="center"><img src="dep_vs_flow_inversed.png" width="100%"/>
</figure>
</a></p>
<p>Thanks to the power of polymorphism.</p>
<h2 id="ddd-cqrs-and-event-sourcing">DDD, CQRS and Event Sourcing</h2>
<p><a href="https://danielwhittaker.me/2020/02/20/cqrs-step-step-guide-flow-typical-application/"><figure class="center"><img src="cqrs.png" width="100%"/>
</figure>
</a></p>
<ul>
<li>differentiating between mutating functions and read-only is best practice 101.</li>
<li>CQRS (without Event Sourcing) is old news. We are running dedicated OLTP DBs for decades.</li>
</ul>
<p>So let&rsquo;s rather focus on Event Sourcing:</p>
<p><a href="https://dev.to/barryosull/event-sourcing-what-it-is-and-why-its-awesome">Why is it cool?</a></p>
<ul>
<li>high modelling flexibility</li>
<li>scalability due to append-only write together with optimistic locking</li>
<li>USP: temporal queries, branching in history for what if scenarios, state time travel</li>
</ul>
<p>Modelling flexibility is my favorite:
<a href="https://www.eventmodeling.org"><figure class="center"><img src="event_modeling.png" width="100%"/>
</figure>
</a></p>
<p>It is a bold promise which I &ndash; due to limited experience &ndash; cannot comment on.</p>
<h4 id="challenges">Challenges:</h4>
<ul>
<li>introduces significant complexity</li>
<li>eventual consistency (at least) on read side</li>
<li>event schema migrations are hard</li>
<li>debugging not straight forward due to Events&rsquo; implicit instead of explicit call paths</li>
</ul>
<p>Overall I found discussion in the Community to be inconsistent. Similar terms different meanings. E.g. &ldquo;Event&rdquo; can mean DomainEvent,
Notification, Command, &hellip;</p>
<h1 id="next-level-food-truck-architecture">Next Level: Food Truck Architecture?</h1>
<blockquote>
<p>Dissolution of the single Domain Model into many parallel worlds.</p>
</blockquote>
<p>Take Event Sourcing, can the idea of Aggregates, generalize event pipelines and then arrive
at an interesting conclusion:</p>
<p><strong>?! The Domain Model Fallacy !?</strong></p>
<p>Or is it more &ldquo;Back to the Future&rdquo;: <a href="https://martinfowler.com/bliki/MultipleCanonicalModels.html">multiple canonical models</a>.</p>
<p><a href="https://ralfw.de/food-truck-architecture-its-all-about-events/"><figure class="center"><img src="food_truck.png" width="100%"/>
</figure>
</a></p>
<p><a href="https://ralfw.de/food-truck-architecture-its-all-about-events/">The Food Truck Architecture</a>
cooks interesting thought food.</p>
<h4 id="value-proposition-maximize-modelling-flexibility">Value Proposition: Maximize Modelling Flexibility</h4>
<blockquote>
<p>The evolutionary demands on software are so huge that I think the first and foremost requirement to fulfill is changeability, malleability. Flexibility first!</p>
</blockquote>
<p><a href="https://ralfw.de/food-truck-architecture-its-all-about-events/">It is all about events</a> was intriguing enough for me
to refine the provided C# example into a <a href="https://github.com/sysid/food_truck">Python model</a> for experimentation and insight.</p>
<p>One pipeline rules all:
<figure class="center"><img src="pipeline.png" width="100%"/>
</figure>
</p>
<p>For every message a bespoke model (projection) is being created and passed to the processor.
And every message (command, query, notification) is handled the same.</p>
<h3 id="conclusion">Conclusion</h3>
<ul>
<li>using a unified pipeline for Commands, Queries and Notifications is a logic development for Event Sourcing, if
not event handling in general. It has potential so simplify architecture.</li>
<li>having bespoke read-only models within every pipeline is a an optional optimization to build business logic</li>
<li>the described development and architecture model reduces cognitive load (after conquering
the non trivial learning curve, of course) due to its simple recipe and purported share nothing architecture.</li>
</ul>
<p>The main issues I found while playing with the code revolve around consistency and concurrency:</p>
<ul>
<li>not having an aggregate with well defined consistency boundaries makes reasoning about consistency and
concurrency difficult if not impossible.</li>
<li>without a aggregate root, I could not find a natural criteria to define event streams. So optimistic
concurrency handling becomes fragile, if possible at all.</li>
</ul>
<p>After all, these issues challenge the very foundation of the model:
Forgoing global business objects (e.g. aggregate) and assuming a shared nothing world between pipelines.</p>
<p>The presented ideas are still very early stages and it is not recommended to jump ship with serious workloads. However, it provides ideas
worth to be explored deeper! And it is definitely a pleasure to read Ralph&rsquo;s clear and well writen articles.</p>
<p>So, at least now I can say, that I used my Covid quarantine in a rewarding way :-).</p>
<h1 id="resources">Resources</h1>
<small>
https://netflixtechblog.com/ready-for-changes-with-hexagonal-architecture-b315ec967749
https://medium.com/gdplabs/clean-architecture-a8b5d93d0944
https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html
https://danielwhittaker.me/2020/02/20/cqrs-step-step-guide-flow-typical-application/
https://ralfw.de/food-truck-architecture-its-all-about-events/
https://www.eventmodeling.org/posts/what-is-event-modeling/
</small>

</content>
<p>
  
  <a href="/blog/python/">#python</a>
  
  <a href="/blog/work/">#work</a>
  
</p>

  </main>
  <footer>
</footer>

    
</body>

</html>
